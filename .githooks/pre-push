#!/bin/bash

echo "Running pre-push hooks..."

# Running Go tests with coverage
echo "Running Go tests..."
cd server
if ! go test ./... -coverprofile=coverage.out ; then
    echo "❌ Go tests failed"
    cd ..
    exit 1
fi

# Display test coverage
go tool cover -func=coverage.out
rm coverage.out
cd ..

# Running frontend tests with coverage
echo "Running frontend tests..."
cd client
if ! npm run coverage ; then
    echo "❌ Frontend tests failed"
    cd ..
    exit 1
fi

# Check if coverage directory exists and display summary
if [ -d "coverage" ]; then
    echo "Frontend test coverage summary:"
    cat coverage/coverage-summary.json | grep -A 3 "total"
    rm -rf coverage
fi
cd ..

echo "✅ All tests passed! Pushing changes..."
exit 0 